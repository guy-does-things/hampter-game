[gd_scene load_steps=22 format=2]

[ext_resource path="res://dreadsitereuse/room_template/Room.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/waterfall/waterfall.tscn" type="PackedScene" id=2]
[ext_resource path="res://water_tm.gd" type="Script" id=3]
[ext_resource path="res://water_tileset.tres" type="TileSet" id=4]
[ext_resource path="res://scenes/chest/chest.tscn" type="PackedScene" id=5]
[ext_resource path="res://watershader.tres" type="Material" id=6]
[ext_resource path="res://scenes/breakable_block/break_block.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/seal/seal.tscn" type="PackedScene" id=8]
[ext_resource path="res://raw_sprites/circletex.png" type="Texture" id=9]
[ext_resource path="res://halweapon/oggrad.tres" type="Texture" id=10]
[ext_resource path="res://lmask.png" type="Texture" id=11]
[ext_resource path="res://locations/basically me ripping off the spring in the sky from la mulana/TileMap.gd" type="Script" id=12]
[ext_resource path="res://moving_platform/moving_p.tscn" type="PackedScene" id=13]
[ext_resource path="res://locations/nitrotasticman/CanvasLayer.gd" type="Script" id=15]
[ext_resource path="res://raw_sprites/bgs/aquaarea/pillars.png" type="Texture" id=16]

[sub_resource type="Shader" id=3]
code = "shader_type canvas_item;


uniform sampler2D colorr;

uniform int has_funny_upgrade = 00;
uniform vec4 woodhandcolor : hint_color;
uniform vec4 woodhandshadowcolor : hint_color;


vec4 darken(vec4 base, vec4 blend){
	return min(base, blend);
}


float abssin(float x)
{
	return ((sin(x)+1.0)/(2.0));
	
}
vec4 hard_light(vec4 base, vec4 blend){
	vec4 limit = step(0.5, blend);
	return mix(2.0 * base * blend, 1.0 - 2.0 * (1.0 - base) * (1.0 - blend), limit);
}
vec4 soft_light(vec4 base, vec4 blend){
	vec4 limit = step(0.5, blend);
	return mix(2.0 * base * blend + base * base * (1.0 - 2.0 * blend), sqrt(base) * (2.0 * blend - 1.0) + (2.0 * base) * (1.0 - blend), limit);
}

vec4 overlay(vec4 base, vec4 blend){
	vec4 limit = step(0.5, base);
	return mix(2.0 * base * blend, 1.0 - 2.0 * (1.0 - base) * (1.0 - blend), limit);
}



vec4 color_burn(vec4 base, vec4 blend){
	return 1.0 - (1.0 - base) / blend;
}


bool colorMatch(vec3 c1, vec3 c2, float maxDiff) {
    return (
        abs(c1.r - c2.r) < maxDiff
        && abs(c1.b - c2.b) < maxDiff
        && abs(c1.b - c2.b) < maxDiff
    );
}



void fragment()
{
	
	vec4 rgba = texture(TEXTURE,UV);

	
	float gs = ((rgba.r + rgba.g + rgba.b) / 3.0) * float(has_funny_upgrade);
	
	
	vec4 truenoisecol = texture(colorr,vec2(abssin( (TIME*3.5)+UV.y*4.0),0));//noisecolor * (abssin(TIME*4.0));
	// only modify the blade's color
	float MDIFF = .01;
	if (
	
		gs > 0.0 && 
		!colorMatch(rgba.rgb,woodhandcolor.rgb,MDIFF) && 
		!colorMatch(rgba.rgb,woodhandshadowcolor.rgb,MDIFF)
		
	)
	{
		float alphamale = rgba.a;
		rgba *= darken(rgba,truenoisecol) * 1.75;
		rgba.a = alphamale;
	}
	
	
	COLOR = rgba;
}


"

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/has_funny_upgrade = 1
shader_param/woodhandcolor = Color( 0.545098, 0.313726, 0.0941176, 1 )
shader_param/woodhandshadowcolor = Color( 0.407843, 0.223529, 0.0941176, 1 )
shader_param/colorr = ExtResource( 10 )

[sub_resource type="Curve" id=2]
_data = [ Vector2( 0, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), -1.01015, 0.0, 0, 0 ]

[sub_resource type="Gradient" id=15]
interpolation_mode = 2
offsets = PoolRealArray( 0.0246305, 0.133005, 0.285714, 1 )
colors = PoolColorArray( 0.913725, 0.380392, 0.843137, 0, 0.913725, 0.380392, 0.843137, 1, 0.329244, 0.223267, 0.96875, 1, 0.0482788, 0.550303, 0.882813, 1 )

[sub_resource type="CanvasItemMaterial" id=13]
blend_mode = 1

[sub_resource type="Animation" id=14]
resource_name = "thing"
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath(".:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.5 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 0.5, 0.5 ), Vector2( 0.25, 0.25 ) ]
}

[node name="A" instance=ExtResource( 1 )]

[node name="RoomRect" parent="." index="0"]
margin_top = -1864.0

[node name="TileMap" parent="." index="1"]
occluder_light_mask = 3
tile_data = PoolIntArray( -7667712, 0, 1, -7667711, 0, 1, -7667710, 0, 1, -7667709, 0, 1, -7667708, 0, 1, -7667707, 0, 1, -7667706, 0, 1, -7667705, 0, 1, -7667704, 0, 1, -7667703, 0, 1, -7667702, 0, 1, -7667701, 0, 1, -7667700, 0, 1, -7667699, 0, 1, -7667698, 0, 1, -7667697, 0, 1, -7667696, 0, 1, -7667695, 0, 1, -7667694, 0, 1, -7667693, 0, 1, -7667692, 0, 1, -7667691, 0, 1, -7667690, 0, 1, -7667689, 0, 1, -7667688, 0, 1, -7667687, 0, 1, -7667686, 0, 1, -7667685, 0, 1, -7667684, 0, 1, -7667683, 0, 1, -7602176, 0, 1, -7602147, 0, 1, -7536640, 0, 1, -7536611, 0, 1, -7471104, 0, 1, -7471091, 7, 0, -7471090, 7, 0, -7471089, 7, 0, -7471088, 7, 0, -7471087, 7, 0, -7471075, 0, 1, -7405568, 0, 1, -7405555, 7, 0, -7405551, 7, 0, -7405539, 0, 1, -7340032, 0, 1, -7340019, 7, 0, -7340015, 7, 0, -7340003, 0, 1, -7274496, 0, 1, -7274486, 0, 1, -7274485, 0, 1, -7274484, 0, 1, -7274483, 0, 1, -7274482, 0, 1, -7274481, 0, 1, -7274480, 0, 1, -7274479, 0, 1, -7274478, 0, 1, -7274477, 0, 1, -7274476, 0, 1, -7274467, 0, 1, -7208931, 0, 1, -7143395, 0, 1, -7077888, 0, 1, -7077887, 0, 1, -7077886, 0, 1, -7077885, 0, 1, -7077884, 0, 1, -7077883, 0, 1, -7077864, 0, 1, -7077863, 0, 1, -7077862, 0, 1, -7077861, 0, 1, -7077860, 0, 1, -7077859, 0, 1, -7012352, 0, 1, -7012351, 0, 1, -7012350, 0, 1, -7012349, 0, 1, -7012348, 0, 1, -7012347, 0, 1, -7012328, 0, 1, -7012327, 0, 1, -7012326, 0, 1, -7012325, 0, 1, -7012324, 0, 1, -7012323, 0, 1, -6946816, 0, 1, -6946815, 0, 1, -6946814, 0, 1, -6946813, 0, 1, -6946812, 0, 1, -6946811, 0, 1, -6946792, 0, 1, -6946791, 0, 1, -6946790, 0, 1, -6946789, 0, 1, -6946788, 0, 1, -6946787, 0, 1, -6881280, 0, 1, -6881279, 0, 1, -6881278, 0, 1, -6881277, 0, 1, -6881276, 0, 1, -6881275, 0, 1, -6881274, 0, 1, -6881273, 0, 1, -6881258, 0, 1, -6881257, 0, 1, -6881256, 0, 1, -6881255, 0, 1, -6881254, 0, 1, -6881253, 0, 1, -6881252, 0, 1, -6881251, 0, 1, -6815744, 0, 1, -6815715, 0, 1, -6750208, 0, 1, -6684672, 0, 1, -6619136, 0, 1, -6553600, 0, 1, -6488064, 0, 1, -6422528, 0, 1, -6422505, 0, 1, -6422504, 0, 1, -6422503, 0, 1, -6422502, 0, 1, -6422501, 0, 1, -6422500, 0, 1, -6422499, 0, 1, -6356992, 0, 1, -6356968, 0, 1, -6356967, 0, 1, -6356966, 0, 1, -6356965, 0, 1, -6356964, 0, 1, -6356963, 0, 1, -6291456, 0, 1, -6291427, 0, 1, -6225920, 0, 1, -6225891, 0, 1, -6160384, 0, 1, -6160355, 0, 1, -6094848, 0, 1, -6094819, 0, 1, -6029312, 0, 1, -6029283, 0, 1, -5963776, 0, 1, -5963747, 0, 1, -5898240, 0, 1, -5898211, 0, 1, -5832704, 0, 1, -5832675, 0, 1, -5767168, 0, 1, -5767139, 0, 1, -5701632, 0, 1, -5701603, 0, 1, -5636096, 0, 1, -5636067, 0, 1, -5570560, 0, 1, -5570531, 0, 1, -5505024, 0, 1, -5504995, 0, 1, -5439488, 0, 1, -5439459, 0, 1, -5373952, 0, 1, -5373923, 0, 1, -5308416, 0, 1, -5308387, 0, 1, -5242880, 0, 1, -5242851, 0, 1, -5177344, 0, 1, -5177315, 0, 1, -5111808, 0, 1, -5111779, 0, 1, -5046272, 0, 1, -5046243, 0, 1, -4980736, 0, 1, -4980707, 0, 1, -4915200, 0, 1, -4915171, 0, 1, -4849664, 0, 1, -4849635, 0, 1, -4784128, 0, 1, -4784099, 0, 1, -4718563, 0, 1, -4653027, 0, 1, -4587497, 0, 1, -4587496, 0, 1, -4587495, 0, 1, -4587494, 0, 1, -4587493, 0, 1, -4587492, 0, 1, -4587491, 0, 1, -4521961, 11, 0, -4521960, 11, 0, -4521959, 11, 0, -4521958, 11, 0, -4521957, 11, 0, -4521956, 11, 0, -4521955, 0, 1, -4456419, 0, 1, -4390912, 0, 1, -4390911, 0, 1, -4390910, 0, 1, -4390909, 0, 1, -4390908, 0, 1, -4390907, 0, 1, -4390883, 0, 1, -4325376, 0, 1, -4325375, 0, 1, -4325374, 0, 1, -4325373, 0, 1, -4325372, 0, 1, -4325371, 0, 1, -4325347, 0, 1, -4259840, 0, 1, -4259811, 0, 1, -4194304, 0, 1, -4194275, 0, 1, -4128768, 0, 1, -4128739, 0, 1, -4063232, 0, 1, -4063203, 0, 1, -3997696, 0, 1, -3997667, 0, 1, -3932160, 0, 1, -3932131, 0, 1, -3866624, 0, 1, -3866595, 0, 1, -3801088, 0, 1, -3801059, 0, 1, -3735552, 0, 1, -3735523, 0, 1, -3670016, 0, 1, -3669987, 0, 1, -3604480, 0, 1, -3604451, 0, 1, -3538944, 0, 1, -3538915, 0, 1, -3473408, 0, 1, -3473379, 0, 1, -3407872, 0, 1, -3407843, 0, 1, -3342336, 0, 1, -3342307, 0, 1, -3276800, 0, 1, -3276771, 0, 1, -3211264, 0, 1, -3211235, 0, 1, -3145728, 0, 1, -3145699, 0, 1, -3080192, 0, 1, -3080163, 0, 1, -3014656, 0, 1, -3014627, 0, 1, -2949120, 0, 1, -2949091, 0, 1, -2883584, 0, 1, -2818048, 0, 1, -2752512, 0, 1, -2752511, 0, 1, -2752510, 0, 1, -2752509, 0, 1, -2752508, 0, 1, -2752507, 0, 1, -2686976, 0, 1, -2686975, 0, 1, -2686974, 0, 1, -2686973, 0, 1, -2686972, 0, 1, -2686971, 0, 1, -2621440, 0, 1, -2621439, 0, 0, -2621438, 0, 0, -2621437, 0, 0, -2621436, 0, 0, -2621435, 0, 0, -2621418, 0, 1, -2621411, 0, 1, -2555904, 0, 1, -2555903, 11, 0, -2555902, 11, 0, -2555901, 11, 0, -2555900, 11, 0, -2555899, 11, 0, -2555882, 0, 1, -2555881, 0, 1, -2555880, 0, 1, -2555879, 0, 1, -2555878, 0, 1, -2555877, 0, 1, -2555876, 0, 1, -2555875, 0, 1, -2490368, 0, 1, -2490344, 0, 1, -2490343, 0, 1, -2490342, 0, 1, -2490341, 0, 1, -2490340, 0, 1, -2490339, 0, 1, -2424832, 0, 1, -2424803, 0, 1, -2359296, 0, 1, -2359267, 0, 1, -2293760, 0, 1, -2293731, 0, 1, -2228224, 0, 1, -2228195, 0, 1, -2162688, 0, 1, -2162659, 0, 1, -2097152, 0, 1, -2097123, 0, 1, -2031587, 0, 1, -1966051, 0, 1, -1900515, 0, 1, -1834979, 0, 1, -1769443, 0, 1, -1703907, 0, 1, -1638371, 0, 1, -1572835, 0, 1, -1507299, 0, 1, -1441763, 0, 1, -1376227, 0, 1, -1310691, 0, 1, -1245178, 0, 0, -1245155, 0, 1, -1179642, 0, 1, -1179619, 0, 1, -1114112, 0, 1, -1114111, 0, 1, -1114110, 0, 1, -1114109, 0, 1, -1114108, 0, 1, -1114107, 0, 1, -1114083, 0, 1, -1048576, 0, 1, -1048547, 0, 1, -983040, 0, 1, -983011, 0, 1, -917504, 0, 1, -917475, 0, 1, -851968, 0, 1, -851939, 0, 1, -786432, 0, 1, -786403, 0, 1, -720896, 0, 1, -720867, 0, 1, -655360, 0, 1, -655331, 0, 1, -589824, 0, 1, -589795, 0, 1, -524288, 0, 1, -524259, 0, 1, -458752, 0, 1, -458723, 0, 1, -393216, 0, 1, -393187, 0, 1, -327680, 0, 1, -327651, 0, 1, -262144, 0, 1, -262115, 0, 1, -196608, 0, 1, -196579, 0, 1, -131072, 0, 1, -131043, 0, 1, -65536, 0, 1, -65507, 0, 1, 0, 0, 1, 29, 0, 1, 65536, 0, 1, 65565, 0, 1, 131072, 0, 1, 131101, 0, 1, 196608, 0, 1, 196637, 0, 1, 262144, 0, 1, 262173, 0, 1, 327680, 0, 1, 327709, 0, 1, 393216, 0, 1, 393245, 0, 1, 458752, 0, 1, 458781, 0, 1, 524288, 0, 1, 524317, 0, 1, 589824, 0, 1, 786458, 0, 1, 786459, 0, 1, 786460, 0, 1, 786461, 0, 1, 851968, 0, 1, 851969, 0, 1, 851970, 0, 1, 851971, 0, 1, 851972, 0, 1, 851973, 0, 1, 851974, 0, 1, 851997, 0, 1, 917504, 0, 1, 917505, 0, 1, 917506, 0, 1, 917507, 0, 1, 917508, 0, 1, 917509, 0, 1, 917510, 0, 1, 917533, 0, 1, 983040, 0, 1, 983041, 0, 1, 983042, 0, 1, 983043, 0, 1, 983044, 0, 1, 983045, 0, 1, 983046, 0, 1, 983069, 0, 1, 1048576, 0, 1, 1048577, 0, 1, 1048578, 0, 1, 1048579, 0, 1, 1048580, 0, 1, 1048581, 0, 1, 1048582, 0, 1, 1048583, 0, 1, 1048584, 0, 1, 1048585, 0, 1, 1048586, 0, 1, 1048587, 0, 1, 1048588, 0, 1, 1048589, 0, 1, 1048590, 0, 1, 1048591, 0, 1, 1048592, 0, 1, 1048593, 0, 1, 1048594, 0, 1, 1048595, 0, 1, 1048596, 0, 1, 1048597, 0, 1, 1048598, 0, 1, 1048599, 0, 1, 1048600, 0, 1, 1048601, 0, 1, 1048602, 0, 1, 1048603, 0, 1, 1048604, 0, 1, 1048605, 0, 1 )
script = ExtResource( 12 )

[node name="Area2D" parent="RoomObjectManager" index="0" instance=ExtResource( 5 )]
unique_name_in_owner = true
position = Vector2( 248, -1792 )
item_to_give = 1024

[node name="Chest" parent="RoomObjectManager/Area2D" index="0"]
material = SubResource( 4 )
frame = 1

[node name="CPUParticles2D" type="CPUParticles2D" parent="RoomObjectManager/Area2D" index="2"]
position = Vector2( 0, -2 )
amount = 32
lifetime = 0.5
randomness = 1.0
texture = ExtResource( 9 )
emission_shape = 1
emission_sphere_radius = 1.94
direction = Vector2( 0, -1 )
spread = 10.0
gravity = Vector2( 0, 0 )
initial_velocity = 140.0
damping = 75.0
scale_amount = 5.0
scale_amount_random = 0.44
scale_amount_curve = SubResource( 2 )
color_ramp = SubResource( 15 )

[node name="Node2D" type="Node2D" parent="RoomObjectManager/Area2D" index="3"]
scale = Vector2( 2, 2 )

[node name="Lmask" type="Sprite" parent="RoomObjectManager/Area2D/Node2D" index="0"]
modulate = Color( 0.337255, 0.0196078, 0.454902, 1 )
material = SubResource( 13 )
scale = Vector2( 0.5, 0.5 )
z_index = 1
texture = ExtResource( 11 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="RoomObjectManager/Area2D/Node2D/Lmask" index="0"]
autoplay = "thing"
anims/thing = SubResource( 14 )

[node name="StaticBody2D" parent="RoomObjectManager" index="1" instance=ExtResource( 7 )]
position = Vector2( 16, -1744 )

[node name="Seal" parent="RoomObjectManager" index="2" instance=ExtResource( 8 )]
position = Vector2( 247, -1726 )

[node name="WaterTileMap" type="TileMap" parent="." index="6"]
tile_set = ExtResource( 4 )
cell_size = Vector2( 16, 16 )
collision_layer = 64
collision_mask = 64
format = 1
tile_data = PoolIntArray( 851975, 0, 0, 851976, 0, 0, 851977, 0, 0, 851978, 0, 0, 851979, 0, 0, 851980, 0, 0, 851981, 0, 0, 851982, 0, 0, 851983, 0, 0, 851984, 0, 0, 851985, 0, 0, 851986, 0, 0, 851987, 0, 0, 851988, 0, 0, 851989, 0, 0, 851990, 0, 0, 851991, 0, 0, 851992, 0, 0, 851993, 0, 0, 851994, 0, 0, 851995, 0, 0, 851996, 0, 0, 917511, 1, 0, 917512, 1, 0, 917513, 1, 0, 917514, 1, 0, 917515, 1, 0, 917516, 1, 0, 917517, 1, 0, 917518, 1, 0, 917519, 1, 0, 917520, 1, 0, 917521, 1, 0, 917522, 1, 0, 917523, 1, 0, 917524, 1, 0, 917525, 1, 0, 917526, 1, 0, 917527, 1, 0, 917528, 1, 0, 917529, 1, 0, 917530, 1, 0, 917531, 1, 0, 917532, 1, 0, 983047, 1, 0, 983048, 1, 0, 983049, 1, 0, 983050, 1, 0, 983051, 1, 0, 983052, 1, 0, 983053, 1, 0, 983054, 1, 0, 983055, 1, 0, 983056, 1, 0, 983057, 1, 0, 983058, 1, 0, 983059, 1, 0, 983060, 1, 0, 983061, 1, 0, 983062, 1, 0, 983063, 1, 0, 983064, 1, 0, 983065, 1, 0, 983066, 1, 0, 983067, 1, 0, 983068, 1, 0 )
script = ExtResource( 3 )
position_to_eject_to = Vector2( 72, 182 )

[node name="ColorRect" type="ColorRect" parent="." index="7"]
material = ExtResource( 6 )
margin_top = -280.0
margin_right = 96.0
margin_bottom = -272.0

[node name="ColorRect4" parent="." index="8" instance=ExtResource( 2 )]
margin_left = 368.0
margin_top = -1096.0
margin_right = 464.0
margin_bottom = 215.0

[node name="ColorRect3" parent="." index="9" instance=ExtResource( 2 )]
margin_left = 16.0
margin_top = -616.0
margin_right = 96.0
margin_bottom = -280.0

[node name="KinematicBody2D" parent="." index="10" instance=ExtResource( 13 )]
position = Vector2( 304, 200 )
start_position = Vector2( 304, 200 )
end_position = Vector2( 304, -696 )

[node name="KinematicBody2D2" parent="." index="11" instance=ExtResource( 13 )]
position = Vector2( 152, -1568 )
current_move_state = 1
start_position = Vector2( 152, -696 )
end_position = Vector2( 152, -1568 )

[node name="BG" type="CanvasLayer" parent="." index="12"]
layer = -8
script = ExtResource( 15 )

[node name="ColorRect" type="ColorRect" parent="BG" index="0"]
anchor_right = 1.0
anchor_bottom = 1.0
color = Color( 0.188235, 0.717647, 0.752941, 1 )

[node name="ColorRect2" parent="BG" index="1" instance=ExtResource( 2 )]
margin_left = 112.0
margin_top = -1856.0
margin_right = 344.0
margin_bottom = 288.0

[node name="BG2" type="CanvasLayer" parent="." index="13"]
layer = -6
follow_viewport_enable = true
follow_viewport_scale = 0.5
script = ExtResource( 15 )

[node name="Node2D" type="Node2D" parent="BG2" index="0"]

[node name="Pillars" type="Sprite" parent="BG2/Node2D" index="0"]
modulate = Color( 0.741176, 0.741176, 0.741176, 1 )
position = Vector2( -120, -800 )
scale = Vector2( 2, 2 )
z_index = -5
texture = ExtResource( 16 )
centered = false
region_enabled = true
region_rect = Rect2( 0, 0, 250, 1080 )

[node name="BG3" type="CanvasLayer" parent="." index="14"]
layer = -6
script = ExtResource( 15 )

[node name="ColorRect2" parent="BG3" index="0" instance=ExtResource( 2 )]
margin_left = 112.0
margin_top = -1856.0
margin_right = 344.0
margin_bottom = 288.0

[editable path="RoomObjectManager/Area2D"]
